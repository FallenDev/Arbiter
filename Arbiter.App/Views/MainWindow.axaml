<ctl:TalgoniteWindow
        xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:ctl="using:Arbiter.App.Controls"
        xmlns:v="using:Arbiter.App.Views"
        xmlns:vm="using:Arbiter.App.ViewModels"
        xmlns:vmc="using:Arbiter.App.ViewModels.Client"
        mc:Ignorable="d"
        x:Class="Arbiter.App.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/aiseirigh.ico"
        Title="{Binding Title}"
        Width="1280" Height="720"
        MinWidth="1280" MinHeight="640"
        CanResize="True"
        WindowStartupLocation="CenterScreen"
        Opened="Window_OnOpened"
        Loaded="Window_OnLoaded"
        Closing="Window_OnClosing">
    <!-- Title Bar Content -->
    <ctl:TalgoniteWindow.TitleBarContent>
        <DockPanel>
            <Button Name="SettingsButton"
                    Command="{Binding ShowSettingsCommand}"
                    HotKey="F10"
                    Classes="control-box"
                    ToolTip.Tip="Opens the Settings window.">
                <Path Width="16"
                      Height="16"
                      Stroke="{Binding $parent[Button].Foreground}"
                      Data="{StaticResource Talgonite.Icon.SettingsGear}"/>
            </Button>
        </DockPanel>
    </ctl:TalgoniteWindow.TitleBarContent>
    
    <Grid Margin="8">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="{Binding LeftPanelWidth, Mode=TwoWay}"
                              MinWidth="240"
                              MaxWidth="360"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="2*" MinWidth="780"/>
            <ColumnDefinition Width="8"/>
            <ColumnDefinition Width="{Binding RightPanelWidth, Mode=TwoWay}"
                              MinWidth="{Binding RightPanelMinWidth}"
                              MaxWidth="{Binding RightPanelMaxWidth}"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel Tabs -->
        <TabControl Name="LeftPanelTabStrip" Grid.Column="0">
            <TabItem Header="Clients">
                <DockPanel>
                    <WrapPanel DockPanel.Dock="Top" Margin="4">
                        <Button Command="{Binding LaunchClientCommand}"
                                HotKey="Ctrl+N"
                                ToolTip.Tip="Launch a new client."
                                Classes="toolbar">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Path Width="16" Height="16"
                                      Stroke="{Binding Path=$parent[Button].Foreground}"
                                      Data="{StaticResource Talgonite.Icon.NewPlus}"/>
                            </StackPanel>
                        </Button>
                    </WrapPanel>
                    <ListBox ItemsSource="{Binding ClientManager.Clients}"
                             SelectedItem="{Binding SelectedClient}"
                             Classes="bubble"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.DataTemplates>
                            <DataTemplate DataType="vmc:ClientViewModel">
                                <v:ClientView/>
                            </DataTemplate>
                        </ListBox.DataTemplates>
                    </ListBox>
                </DockPanel>
            </TabItem>
        </TabControl>
        
        <GridSplitter Grid.Column="1" ResizeDirection="Columns"/>
        
        <!-- Center Area -->
        <Grid Name="CenterContentGrid" Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*" MinHeight="160"/>
                <RowDefinition Height="8"/>
                <RowDefinition Height="{Binding BottomPanelHeight, Mode=TwoWay}"
                               MinHeight="{Binding BottomPanelMinHeight}"
                               MaxHeight="{Binding BottomPanelMaxHeight}"/>
            </Grid.RowDefinitions>
            
            <TabControl Grid.Row="0">
                <TabItem Header="Trace">
                    <v:TraceView DataContext="{Binding Trace}"/>
                </TabItem>
            </TabControl>
            
            <GridSplitter Grid.Row="1" ResizeDirection="Rows"
                          IsVisible="{Binding !IsBottomPanelCollapsed}"/>
            
            <!-- Bottom Panel -->
            <Panel Grid.Row="2" IsVisible="{Binding !IsBottomPanelCollapsed}">
                <TabControl SelectedIndex="{Binding SelectedBottomTabIndex}">
                    <!-- Bottom Area -->
                    <TabItem Header="Send">
                        <v:SendPacketView DataContext="{Binding SendPacket}"/>
                    </TabItem>
                    <TabItem Header="Console">
                        <v:ConsoleLogView DataContext="{Binding Console}"/>
                    </TabItem>
                </TabControl>
                <!-- Collapse Button -->
                <Button Command="{Binding ToggleBottomPanelCommand}"
                        Classes="toolbar"
                        ToolTip.Tip="Collapses the bottom panel."
                        CornerRadius="2"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Padding="4"
                        Margin="2">
                    <Path Stroke="{Binding $parent[Button].Foreground}"
                          Data="{StaticResource Talgonite.Icon.DownChevron}"/>
                </Button>
            </Panel>
            
            <!-- Collapsed Bottom Panel -->
            <Panel Grid.Row="2"
                   Background="{StaticResource Talgonite.TabStrip.Background}"
                   IsVisible="{Binding IsBottomPanelCollapsed, FallbackValue={x:False}}">
                <WrapPanel ItemSpacing="4">
                    <Button Command="{Binding ToggleBottomPanelCommand}" CommandParameter="send"
                            Content="Send"
                            Classes="tab"
                            ToolTip.Tip="Shows the Send packet view."/>
                    <Button Command="{Binding ToggleBottomPanelCommand}" CommandParameter="console"
                            Content="Console"
                            Classes="tab"
                            ToolTip.Tip="Shows the Console view."/>
                </WrapPanel>
            </Panel>
        </Grid>
        
        <GridSplitter Grid.Column="3" ResizeDirection="Columns"
                      IsVisible="{Binding !IsInspectorPanelCollapsed}"/>
        
        <!-- Right Panel Tabs -->
        <Panel Grid.Column="4" IsVisible="{Binding !IsInspectorPanelCollapsed}">
            <TabControl Name="RightPanelTabStrip" SelectedIndex="{Binding SelectedInspectorTabIndex}">
                <TabItem Header="Inspector" IsSelected="True">
                    <v:InspectorView DataContext="{Binding Inspector}"/>
                </TabItem>
                <TabItem Header="Hex">
                    <v:HexView DataContext="{Binding SelectedRawHex}"/>
                </TabItem>
            </TabControl>
            <!-- Collapse Button -->
            <Button Command="{Binding ToggleInspectorPanelCommand}"
                    Classes="toolbar"
                    ToolTip.Tip="Collapses the inspector panel."
                    CornerRadius="2"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Padding="4"
                    Margin="2">
                <Path Stroke="{Binding $parent[Button].Foreground}"
                      Data="{StaticResource Talgonite.Icon.RightChevron}"/>
            </Button>
        </Panel>
        <!-- Right Panel Collapsed View -->
        <Panel Grid.Column="4"
               Background="{StaticResource Talgonite.TabStrip.Background}"
               IsVisible="{Binding IsInspectorPanelCollapsed, FallbackValue={x:False}}">
            <LayoutTransformControl LayoutTransform="rotate(90deg)">
                <WrapPanel ItemSpacing="4">
                    <Button Command="{Binding ToggleInspectorPanelCommand}" CommandParameter="inspector"
                            Content="Inspector"
                            Classes="tab"
                            ToolTip.Tip="Shows the Inspector view."/>
                    <Button Command="{Binding ToggleInspectorPanelCommand}" CommandParameter="hex"
                            Content="Hex"
                            Classes="tab"
                            ToolTip.Tip="Shows the Hex view."/>
                </WrapPanel>
            </LayoutTransformControl>
        </Panel>
    </Grid>
    

</ctl:TalgoniteWindow>
